# プロジェクト設定

## 目次

- 1. 基本ルール
  - 1.1 自動承認ルール
  - 1.2 ユーザー確認が必要な場合
  - 1.3 CLAUDEルール修正手順
  - 1.4 ドキュメント読み込みルール
  - 1.5 Git操作ルール
- 2. GitHub Push前確認
  - 2.1 チェックリスト
- 3. ドキュメント管理：全ドキュメント共通
  - 3.1 フォルダ構成
  - 3.2 ファイル命名規則
  - 3.3 運用ルール
- 4. ドキュメント管理：要件・設計書
  - 4.1 列構成（22列）
  - 4.2 ID命名規則
  - 4.3 詳細と決定理由の番号対応
  - 4.4 記載内容の定義
- 5. ドキュメント管理：テスト仕様書
  - 5.1 列構成（18列）
  - 5.2 データコピールール
  - 5.3 検証結果ステータス
  - 5.4 P〜R列（原因・解決策）の記載ルール
  - 5.5 検証ルール
- 6. ドキュメント管理：エラー管理
  - 6.1 列構成（18列）
  - 6.2 起票ガイドライン
- 7. セッション引き継ぎ
  - 7.1 ファイル命名
  - 7.2 記載内容
  - 7.3 自動更新トリガー
  - 7.4 新規セッション開始時

---

## 1. 基本ルール

### 1.1 自動承認ルール
- 確認プロンプト（Yes/No/Do you want to proceed?など）は基本的にYesを選択して自動的に進める
- ユーザーへの確認なしで作業を継続する

### 1.2 ユーザー確認が必要な場合
以下のケースは必ずユーザーに確認を取ること：
- AWSリソースの作成・削除・変更（EC2インスタンス、RDS、Lambda等）
- 課金に影響する操作全般
- 本番環境への変更
- 取り消しが困難な破壊的操作

### 1.3 CLAUDEルール修正手順
1. **修正方針の提示**: どのセクションをどのように修正するかをまとめてユーザーに確認
2. **承認後に実行**: ユーザーの承認を得てから修正作業を開始
3. **pushで完了**: 修正完了後、GitHubへpush

### 1.4 ドキュメント読み込みルール
- **mdファイルを優先**: ドキュメントの内容を確認する際は、Excelファイル(.xlsx)ではなくMarkdownファイル(.md)を読み込む
- **Excelファイルを読む場合**: ユーザーから「Excelファイルを修正して」等の明示的な指示があった場合のみ
- **理由**: mdファイルはReadツールでそのまま読めるため、内容把握が効率的

### 1.5 Git操作ルール
- **マージ前に必ず`git fetch origin`を実行**: リモートブランチの最新状態を取得してからマージ・比較を行う
- **理由**: `git fetch`しないとローカルにキャッシュされた古いリモート情報を参照してしまい、新しいコミットを見逃す可能性がある

```bash
# 正しい手順
git fetch origin
git merge origin/ブランチ名

# 誤った手順（新しいコミットを見逃す可能性あり）
git merge origin/ブランチ名  # ← fetchせずにマージ
```

---

## 2. GitHub Push前確認

### 2.1 チェックリスト

| # | チェック項目 |
|---|-------------|
| 1 | バージョン番号を上げているか？ |
| 2 | 旧バージョンを「過去ドキュメント」に移動したか？ |
| 3 | ファイル命名が `ドキュメント名_verXX.md` 形式か？ |
| 4 | 最新ドキュメントフォルダに配置しているか？ |

**理由**: 同じバージョン番号で上書きすると、ユーザーが古いファイルを参照してしまい混乱を招くため

---

## 3. ドキュメント管理：全ドキュメント共通

### 3.1 フォルダ構成
```
docs/
├── 最新ドキュメント/
│   ├── 要件・設計書_verXX.md
│   ├── テスト仕様書_verXX.md
│   ├── エラー管理_verXX.md
│   └── 変更履歴_verXX.md
│
├── 過去ドキュメント/
│   └── （旧バージョンのドキュメント）
│
└── セッション引き継ぎ/
    └── セッション引き継ぎ_verX.md
```

### 3.2 ファイル命名規則
| 項目 | ルール | 例 |
|-----|--------|-----|
| バージョン | _verXX（初版からver01） | ver01, ver02 |
| 形式 | `ドキュメント名_verXX.md` | 要件・設計書_ver05.md |

### 3.3 運用ルール
1. 最新版は「最新ドキュメント」フォルダに各種類1ファイルずつ配置
2. ドキュメント更新時は旧版を「過去ドキュメント」に移動してから、新版を格納
3. 更新をする場合は、必ず `_verXX` を上げる
4. 変更履歴は `変更履歴_verXX.md` で一元管理（各設計書には記載しない）

---

## 4. ドキュメント管理：要件・設計書

### 4.1 列構成（22列）
| 列 | 列名 | グループ |
|----|------|----------|
| A | （空列） | - |
| B | No | No |
| C | 業務：大分類 | 業務要件 |
| D | 大分類ID | 業務要件 |
| E | 業務：中分類 | 業務要件 |
| F | 中分類ID | 業務要件 |
| G | 業務 | 業務要件 |
| H | 業務ID | 業務要件 |
| I | 詳細 | 業務要件 |
| J | SRID | システム |
| K | 概要 | システム |
| L | 詳細 | システム |
| M | 決定理由 | システム |
| N | 概要 | 設計 |
| O | 詳細 | 設計 |
| P | 決定理由 | 設計 |
| Q | 関連ファイル | 設計 |
| R | 優先度 | 管理 |
| S | ステータス | 管理 |
| T | 却下理由 | 管理 |
| U | 課題No | 管理 |
| V | 起票日 | 管理 |

### 4.2 ID命名規則

#### 業務要件ID（3階層）
| 階層 | 列 | 形式 | 例 |
|------|-----|------|-----|
| 大分類 | D列 | `BIZ-XXX` | BIZ-001, BIZ-002 |
| 中分類 | F列 | `BIZ-XXX-XX` | BIZ-001-01, BIZ-001-02 |
| 業務 | H列 | `BIZ-XXX-XX-XX` | BIZ-001-01-01, BIZ-001-01-02 |

#### システム要件ID
| ID種別 | 列 | 形式 | 例 |
|--------|-----|------|-----|
| システム要件ID | J列 | `SYS-XXX-XX-XX-XX` | SYS-001-01-01-01, SYS-001-01-01-02 |

**ルール:**
- 業務要件IDの階層に対応してシステム要件IDを採番
- 1つの業務（BIZ-XXX-XX-XX）に対して複数のシステム要件がある場合、末尾番号を付与
- 例: `BIZ-001-01-01`に対するシステム要件 → `SYS-001-01-01-01`, `SYS-001-01-01-02`

### 4.3 詳細と決定理由の番号対応
詳細と決定理由は番号で紐づけて記載する。

| 対象 | 詳細列 | 決定理由列 | 記載例 |
|------|--------|-----------|--------|
| システム要件 | L列 | M列 | 詳細「1. xxx 2. yyy」→ 理由「1. aaa 2. bbb」 |
| 設計 | O列 | P列 | 詳細「1. xxx 2. yyy」→ 理由「1. aaa 2. bbb」 |

**ルール:**
- 詳細が複数ある場合は「1. 2. 3.」と番号を付ける
- 決定理由も同じ番号で対応させる（詳細1の理由は理由1）

### 4.4 記載内容の定義
| 項目 | 定義 |
|-----|------|
| 業務要件 | 「何を実現したいか」（実現手段を含まない純粋な要求） |
| システム要件 | 「どう実現するか」の方向性（概要・詳細・決定理由を記載） |
| 設計 | 具体的な技術・実装方法（概要・詳細・決定理由・関連ファイルを記載） |

---

## 5. ドキュメント管理：テスト仕様書

### 5.1 列構成（18列）
| 列 | 列名 | 要件・設計書からのマッピング |
|----|------|-------------------------------|
| A | （空列） | - |
| B | No | B列(No) |
| C | 環境 | E列(環境) |
| D | 業務要件：概要 | F列(大分類) |
| E | 業務要件：詳細 | H列(詳細) |
| F | システム要件：概要 | L列(概要) |
| G | システム要件：詳細 | N列(詳細) |
| H | 設計 | R列(概要_cl) |
| I | 使用データ項目 | - |
| J | データインプット | - |
| K | データアウトプット | - |
| L | 検証方法 | - |
| M | 期待値 | - |
| N | 検証結果 | - |
| O | 現状 | - |
| P | 原因 | NG/課題ありの場合に記載 |
| Q | 原因推測理由 | NG/課題ありの場合に記載 |
| R | 想定解決策 | NG/課題ありの場合に記載 |

### 5.2 データコピールール
- **コピー対象**: B(No), C(環境), D(業務要件：概要), E(業務要件：詳細), F(システム要件：概要), G(システム要件：詳細), H(設計)
- **コピー後は変更禁止**: 一度コピーした後はB〜H列を勝手に変更しない
- **バージョンアップ時**: 旧バージョンの全データを引き継ぎ、I列以降のみ更新する

### 5.3 検証結果ステータス
| ステータス | 定義 |
|:---|:---|
| OK | 実際の動作確認完了 |
| 部分OK | 一部のみ確認。残りは依存要件完了後に検証 |
| NG | 検証したが失敗/未完了 |
| 要確認 | 検証未実施。前提条件の確認が必要 |
| 改修待ち | コード確認のみ。依存要件完了後に検証可能 |

### 5.4 P〜R列（原因・解決策）の記載ルール
検証結果がNG/課題ありの場合のみ記載：
- **P列（原因）**: 発生した問題の直接的な原因
- **Q列（原因推測理由）**: なぜその原因と判断したかの根拠
- **R列（想定解決策）**: 問題を解決するための対策案

### 5.5 検証ルール
- **コード確認のみでOKにしない**: 実際にEC2上で動作確認を行うこと
- **依存関係を明記**: 他の要件完了が前提の場合は「改修待ち」とし、依存先を備考に記載
- **部分的な確認は部分OK**: 全要件の一部のみ確認した場合は「部分OK」とし、未確認項目を明記

---

## 6. ドキュメント管理：エラー管理

### 6.1 列構成（18列）
| 列 | 項目名 | 入力内容・備考 |
|----|--------|----------------|
| A | （空列） | - |
| B | エラーNo | 連番を手動入力（例：1, 2, 3...） |
| C | BRID | 要件・設計管理のD列(BRID_cl)から転記 |
| D | SRID | 要件・設計管理のJ列(SRID_cl)から転記 |
| E | システム要件詳細 | 要件・設計管理のO列(詳細)から転記 |
| F | 発生日付 | yyyy/mm/dd |
| G | 優先度 | 高 / 中 / 低 |
| H | タイトル | 発生画面と現象を一言で記載 |
| I | 再現手順 | 箇条書きで操作手順を記載 |
| J | 期待される動作 | 本来どうなるべきだったか（正解）を記載 |
| K | 実際の動作 | 発生した現象（不正解）を記載 |
| L | エラー文言/コード | 表示されたエラーメッセージやコードを一字一句正確に転記 |
| M | 発生環境 | OS、ブラウザ、端末、使用したテストデータIDなど |
| N | 起票者 | 氏名 |
| O | ステータス | 未着手 / 調査中 / 対応済 / 完了 / 保留 |
| P | 原因 | エラーの原因（追記時は日時を記載） |
| Q | 解決策 | 試した解決策（追記時は日時を記載） |
| R | 結論 | 最終的な結果と対応内容 |

### 6.2 起票ガイドライン

**【重要】本プロジェクトではスクリーンショット等の画像添付を行いません。そのため、「文章だけで現象が正確に伝わること」が必須です。**

#### 6.2.1 エラーNo、BRID/SRIDの記載について
- **エラーNo**: 直前の行に続く連番を手動で入力してください（重複厳禁）
- **BRID/SRID/システム要件詳細**: 要件・設計管理の該当行から、D列(BRID_cl)、J列(SRID_cl)、O列(詳細)をそのままコピー＆ペーストしてください（要約はNG）

#### 6.2.2 「優先度」の基準
| 優先度 | 基準 |
|--------|------|
| 高 | システム停止、データ消失、主要業務（ログイン・決済等）の不可。（即日対応必須） |
| 中 | エラーは出るが回避策がある、または仕様と挙動が異なる。（通常のバグ） |
| 低 | 表示崩れ、誤字脱字、使い勝手の問題。 |

#### 6.2.3 「再現手順」の書き方（最重要）
画像がないため、入力した値を省略せず具体的に書いてください。

**悪い例：**
```
数値を入力して登録ボタンを押す。
```

**良い例：**
```
1. 入力欄「数量」に 10,000 （全角カンマ付）を入力する
2. 入力欄「備考」を空欄にする
3. 「登録」ボタンを押下する
```

#### 6.2.4 エラー文言/コードの転記について
画面に表示されたエラーメッセージは、一字一句省略せずに「L列：エラー文言/コード」へ転記してください。

- **良い例**: `Error 500: Internal Server Error (Code: 9921)`
- **悪い例**: `エラーが出ました`、`500エラー等`

#### 6.2.5 「期待値」と「実績値」の書き方
- **期待される動作**: 仕様書に基づく「正解」を記述（例：完了メッセージが表示され、画面がトップに戻る）
- **実際の動作**: 実際に起きた現象を記述（例：画面が白くなり、何も表示されない）

#### 6.2.6 「原因」「解決策」列の追記ルール
- **追記時は日時を記載**: `【YYYY/MM/DD HH:MM】` の形式で開始
- **追記は下に追加**: 既存コメントが上、新しい追記を下に追加していく
- **最新の追記で状況がわかるように**: 現在の調査状況・対応状況を明記

**記載例（原因列）:**
```
【原因】
Residential ProxyがリクエストごとにランダムなIPを割り当てる。

【2025/12/09 14:30】
PC側Cookie取得時のIPとEC2側Cookie使用時のIPが異なることを確認。

【2025/12/09 18:45】
city-tokyoパラメータで地域指定することでIP固定可能と判明。
```

#### 6.2.7 エラー対応中に発生した新規エラーの起票ルール
エラーNo.Xの解決策を試行中に別のエラーが発生した場合：

**【解決策が失敗した場合】**
→ 新規行でエラーを起票する
- **BRID/SRID/システム要件詳細**: 元のエラー（No.X）と同じ値をコピー
- **タイトル**: 「エラーNo.Xの対応＋発生した問題」の形式
  - 例: 「エラーNo.2の対応：Sticky Sessionパラメータで407認証エラー」
- **再現手順以降**: 通常通り記載

**【解決策が成功した場合】**
→ 元のエラー（No.X）の「結論」列に結果を記載
- 試した解決策とその結果を記載
- 関連するエラーNo.があれば参照を記載
- 例: 「解決策Z①で407エラー発生（エラーNo.3参照）、解決策Z②で解決。ステータス→完了」

#### 6.2.8 原因・解決策・結論の詳細記載ルール
**文章だけで状況が正確に伝わること**が必須。曖昧な表現や省略は禁止。

**【原因列の記載内容】**
| 必須項目 | 記載例 |
|----------|--------|
| 直接的な技術原因 | 「Residential ProxyがリクエストごとにランダムなIPを割り当てる」 |
| なぜ問題が発生したか | 「Cookie取得時IP（138.64.x.x）と使用時IP（42.108.x.x）が異なるためLinkedInがセッション無効化」 |
| 類似原因との違い | 「No.1は通常回線vsProxy（ネットワーク種別の違い）、No.2はProxy内でのIPローテーション（同一プロキシ内の変動）」 |

**【解決策列の記載内容】**
| 必須項目 | 記載例 |
|----------|--------|
| 試した解決策 | 「ユーザー名に`session-linkedin1`パラメータを追加」 |
| 具体的な設定値 | 「ポート: 7000 → 10001に変更、ユーザー名: `user-sp9fa9dui3-country-jp-city-tokyo`」 |
| 参照した情報源 | 「Decodoドキュメント: https://help.decodo.com/docs/...」 |
| 結果 | 「HTTP 407認証エラー発生 → エラーNo.3として起票」 |

**【結論列の記載内容】**
| 必須項目 | 記載例 |
|----------|--------|
| 最終的な解決方法 | 「ポート10001 + city-tokyoパラメータで同一IP固定に成功」 |
| 確認した結果 | 「PC側IP: 138.64.115.164、EC2側IP: 138.64.115.164（一致）」 |
| 関連エラーの参照 | 「解決策試行中にエラーNo.3,4,5が発生（それぞれ完了済）」 |
| 残課題（あれば） | 「seleniumwire使用時にSSL問題あり。Chrome拡張機能方式に変更後、再検証必要」 |

**【禁止する曖昧な表現】**
- NG: 「IPが違うから」 → OK: 「PC側IP（138.64.x.x）とEC2側IP（42.108.x.x）が異なるため」
- NG: 「設定を変更した」 → OK: 「ポート7000→10001、ユーザー名にcountry-jp-city-tokyoを追加」
- NG: 「エラーが出た」 → OK: 「HTTP 407 Proxy Authentication Requiredエラー発生」
- NG: 「同じ原因」 → OK: 「両方ともIP不一致が原因だが、No.1は通常回線vsProxy、No.2はProxy内のIPローテーションという違いがある」

---

## 7. セッション引き継ぎ

### 7.1 ファイル命名
- 形式: `セッション引き継ぎ_verX.md`
- 保存場所: `docs/セッション引き継ぎ/`

### 7.2 記載内容（詳細に記載）
1. **現在の作業内容** - 何をしているか、どこまで進んでいるか
2. **完了したタスク** - 今回のセッションで完了した作業の詳細
3. **次にやるべきこと** - 優先順位付きで具体的に記載
4. **未解決の問題** - エラー、課題、検討事項など
5. **重要なコンテキスト** - 次のセッションで知っておくべき背景情報
6. **関連ファイル** - 作業で使用・変更したファイルパス

### 7.3 自動更新トリガー
AIが自発的に引き継ぎファイルを更新するタイミング：
- **作業区切り時**: 大きなタスクが完了したとき
- **トリガーワード**: 「ok」「done」「終わり」「おわり」「まとめて」「引き継ぎ」

### 7.4 新規セッション開始時（必須）
1. セッション引き継ぎファイルを読み込む
2. 最新ドキュメントに入っている資料を全て読み込む
3. 関連ソースコードを読み込む
